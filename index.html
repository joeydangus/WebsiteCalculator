
  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Instant Quote — PDF Export</title>
<script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
  /* reuse calculator styles (compact) */
  body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#fff;color:#0f172a}
  .shell{max-width:980px;margin:20px auto;padding:10px}
  .box{border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
  .hero{padding:16px;border-bottom:1px solid #e5e7eb}
  .grid{display:grid;grid-template-columns:1.05fr .95fr}
  @media (max-width:880px){.grid{grid-template-columns:1fr}}
  .pane{padding:14px}
  .label{font-weight:600;margin-bottom:6px;display:block}
  input[type="number"], select{padding:8px 10px;border-radius:8px;border:1px solid #e5e7eb;width:100%}
  .seg{display:flex;background:#f8fafc;border-radius:999px;padding:4px}
  .seg button{flex:1;border:0;background:transparent;padding:8px 12px;border-radius:999px;cursor:pointer}
  .seg button.active{background:#fff;border:1px solid #e5e7eb;color:#509E2E}
  .item-pair{display:flex;gap:8px}
  .item-pair input{flex:1}
  .actions{display:flex;gap:8px;margin-top:12px}
  .btn{padding:10px 12px;border-radius:8px;border:1px solid #e5e7eb;cursor:pointer}
  .btn.primary{background:#509E2E;color:#fff;border-color:#407E25}
  .muted{color:#64748b;font-size:0.9rem}
  /* Branding & summary styles (match calculator) */
  .section-label{font-weight:700;color:#334155;margin-bottom:8px}
  .old-price{color:#94a3b8;text-decoration:line-through;font-size:1rem}
  .new-price{color:var(--primary,#509E2E);font-weight:800;font-size:1.6rem}
  /* larger primary total */
  .new-price{font-size:1.9rem}
  .badge{display:inline-block;background:#dcfce7;color:#065f46;border:1px solid #bbf7d0;padding:6px 10px;border-radius:999px;font-weight:700}
  .breakdown{margin-top:10px;display:grid;gap:6px}
  .row2{display:flex;justify-content:space-between}
  .psf{display:block;font-size:.85rem;color:#94a3b8}
  /* printable container styling */
  #pdf-content{display:none;padding:24px;color:#0f172a}
  .pdf-header{display:flex;justify-content:space-between;align-items:center}
  .brand{color:#509E2E;font-weight:800;font-size:1.25rem}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  td,th{padding:6px;border:1px solid #eaeef0}
  th{background:#f8fafc;text-align:left}
  .right{text-align:right}
  .keypoints{display:grid;grid-template-columns:1fr 1fr;gap:6px;list-style:disc;padding-left:18px;margin-top:6px}
  .keypoints li{margin:4px 0;font-size:0.7rem;color:#94a3b8}
</style>
</head>
<body>
  <div class="shell">
    <div class="box">
      <div class="hero">
        <h1>Instant Quote Calculator</h1>
        <p class="muted">Enter the pricing for your current solution and get an instant comparison</p>
      </div>
      <div class="grid">
        <div class="pane">
          <label class="label">Quote Mode</label>
          <div class="seg" role="tablist">
            <button id="mode-quick" class="active">Quick Quote</button>
            <button id="mode-itemized">Itemized Quote</button>
          </div>

          <div style="margin-top:10px">
            <label class="label">Build type</label>
            <div class="seg" role="tablist">
              <button id="type-res" class="active">Residential</button>
              <button id="type-multi">Multi‑family</button>
            </div>
          </div>

          <div style="margin-top:10px">
            <label class="label">Backer CI board thickness</label>
            <select id="backer-thickness">
              <option value="51.25">1/2"</option>
              <option value="66.25">3/4"</option>
              <option value="81.25" selected>1"</option>
              <option value="106.25">1-1/2"</option>
              <option value="127.50">2"</option>
              <option value="147.50">2-1/2"</option>
            </select>
            <div class="muted">Based on a 4 x 8 board.</div>
          </div>

          <div style="margin-top:10px">
            <label class="label">Total wall area (SF)</label>
            <input id="sf" type="number" min="0" step="0.00001" value="0" />
          </div>

          <div style="margin-top:10px">
            <label class="label">Total projected carry costs (USD)</label>
            <input id="carry-cost" type="number" min="0" step="0.00001" value="0" />
          </div>

          <div id="quick-section" style="margin-top:10px">
            <label class="label">Current materials cost ($/SF)</label>
            <input id="trad-mat-psf" type="number" min="0" step="0.00001" value="0" />
            <label class="label" style="margin-top:8px">Current labor cost ($/SF)</label>
            <input id="trad-lab-psf" type="number" min="0" step="0.00001" value="0" />
          </div>

          <div id="itemized-section" style="display:none;margin-top:10px">
            <div class="muted">Itemized inputs</div>
            <div style="margin-top:8px">
              <label class="label">WRB</label>
              <div class="item-pair"><input class="item-mat" id="mat-wrb" placeholder="Mat $/SF" type="number" step="0.00001" /><input class="item-lab" id="lab-wrb" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">EPS Foam</label>
              <div class="item-pair"><input class="item-mat" id="mat-eps" placeholder="Mat $/SF" type="number" step="0.00001" /><input class="item-lab" id="lab-eps" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">Metal Wire</label>
              <div class="item-pair"><input class="item-mat" id="mat-wire" placeholder="Mat $/SF" type="number" step="0.00001" /><input class="item-lab" id="lab-wire" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">Fasteners</label>
              <div class="item-pair"><input class="item-mat" id="mat-fasteners" placeholder="Mat $/SF" type="number" step="0.00001" /><input class="item-lab" id="lab-fasteners" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">Metal Trim</label>
              <div class="item-pair"><input class="item-mat" id="mat-trim" placeholder="Mat $/SF" type="number" step="0.00001" /><input class="item-lab" id="lab-trim" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">Base Coat</label>
              <div class="item-pair"><input class="item-mat" id="mat-base" placeholder="Mat $/SF" type="number" step="0.00001" /><input class="item-lab" id="lab-base" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">Finish Coat</label>
              <div class="item-pair"><input class="item-mat" id="mat-finish" placeholder="Mat $/SF" type="number" step="0.00001" /><input class="item-lab" id="lab-finish" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">Bldg Prep (lab-only)</label>
              <div class="item-pair"><input class="item-lab" id="lab-prep" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">Mobilization (lab-only)</label>
              <div class="item-pair"><input class="item-lab" id="lab-mobil" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
            <div style="margin-top:8px">
              <label class="label">Cleanup (lab-only)</label>
              <div class="item-pair"><input class="item-lab" id="lab-cleanup" placeholder="Lab $/SF" type="number" step="0.00001" /></div>
            </div>
          </div>

          <div style="margin-top:8px">
            <button class="btn" id="reset">Reset</button>
          </div>

          <div style="margin-top:12px">
            <div class="section-label">Key Points</div>
            <ul class="keypoints">
              <li>Better resale value over time</li>
              <li>Builders Insurance Savings</li>
              <li>Carry Insurance Savings</li>
              <li>Shorter Curing Times Between Coats</li>
              <li>No Lath Inspections</li>
              <li>De-risk labor inflation costs</li>
              <li>Reduced Trash Haul Away</li>
            </ul>
          </div>

          <div class="actions">
            <button class="btn primary" id="create-pdf" style="display:none">Download PDF Quote</button>
          </div>
        </div>

        <div class="pane" id="preview">
          <div class="section-label">Traditional Methods:</div>
          <div class="price-row" style="display:flex;align-items:center;gap:12px;">
            <span class="old-price" id="old-total">$0.00</span>
            <span class="psf" id="old-psf">$0.00/SF</span>
          </div>

          <div class="section-label" style="margin-top:12px">HydroBlok:</div>
          <div class="price-row" style="display:flex;align-items:center;gap:12px;">
            <div class="new-price" id="new-total">$0.00</div>
            <span class="badge" id="pct">0.0% savings</span>
            <span class="psf" id="new-psf">$0.00/SF</span>
          </div>

          <div class="breakdown" style="margin-top:10px">
            <div class="row2"><span>Traditional materials</span><strong id="old-mat">$0.00</strong></div>
            <div class="row2"><span>Traditional labor</span><strong id="old-lab">$0.00</strong></div>
            <div class="row2"><span>HydroBlok materials</span><strong id="new-mat">$0.00</strong></div>
            <div class="row2"><span>HydroBlok labor</span><strong id="new-lab">$0.00</strong></div>
            <div class="row2"><span>Hydroblok Carry cost</span><strong id="carry-sav">$0.00 (18%)</strong></div>
            <div class="row2" style="border-top:1px solid #e5e7eb;padding-top:8px">
              <span>Savings vs traditional</span>
              <div style="display:flex;flex-direction:column;align-items:flex-end">
                <strong id="delta">$0.00</strong>
                <span class="psf" id="delta-psf">$0.00/SF</span>
              </div>
            </div>
            <div style="margin-top:12px;display:flex;gap:8px;flex-direction:column;align-items:flex-start">
              <button class="btn primary" id="create-pdf-right">Download PDF Quote</button>
              <p class="muted" style="margin-top:8px">Quote susceptible to change based on individual project requirements</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF printable container (populated at export time) -->
  <div id="pdf-content"></div>

<script>
// HYDRO_ITEMS same as in calc.html
const HYDRO_ITEMS = [
  { name: 'Tyvek WRB', key: 'wrb', mat_psf: 0.18, lab_psf: 0.25 },
  { name: 'Backer CI (R-5)', key: 'eps', mat_psf: 2.69, lab_psf: 0.50 },
  { name: 'Fasteners', key: 'fasteners', mat_psf: 0.17, lab_psf: 0.15 },
  { name: 'Washers', key: 'washer', mat_psf: 0.15, lab_psf: 0.10 },
  { name: 'Metal Trim', key: 'trim', mat_psf: 0.75, lab_psf: 0.25 },
  { name: 'HB Base', key: 'base', mat_psf: 0.33, lab_psf: 1.00 },
  { name: 'Stucco Mesh', key: 'mesh', mat_psf: 0.19, lab_psf: 0.15 },
  { name: 'Acrylic Finish', key: 'finish', mat_psf: 0.58, lab_psf: 1.00 },
  { name: 'Bldg Prep', key: 'prep', mat_psf: 0.00, lab_psf: 0.20 },
  { name: 'Mobilization', key: 'mobil', mat_psf: 0.00, lab_psf: 0.05 },
  { name: 'Cleanup', key: 'cleanup', mat_psf: 0.00, lab_psf: 0.05 }
];

const RATES = { new: { mat_psf: HYDRO_ITEMS.reduce((s,it)=>s+(it.mat_psf||0),0), lab_psf: HYDRO_ITEMS.reduce((s,it)=>s+(it.lab_psf||0),0) }};
RATES.new.inst_psf = RATES.new.mat_psf + RATES.new.lab_psf;

function fmtUSD(x){return new Intl.NumberFormat(undefined,{style:'currency',currency:'USD'}).format(x)}

// Elements
const sfEl = document.getElementById('sf');
const carryEl = document.getElementById('carry-cost');
const tradMatEl = document.getElementById('trad-mat-psf');
const tradLabEl = document.getElementById('trad-lab-psf');
const createPdfBtn = document.getElementById('create-pdf');
const backerSelect = document.getElementById('backer-thickness');

// Mode toggles
const modeQuickBtn = document.getElementById('mode-quick');
const modeItemBtn = document.getElementById('mode-itemized');
let quoteMode = 'quick';
modeQuickBtn.addEventListener('click', ()=>{quoteMode='quick';modeQuickBtn.classList.add('active');modeItemBtn.classList.remove('active');document.getElementById('quick-section').style.display='';document.getElementById('itemized-section').style.display='none'; renderPreview();});
modeItemBtn.addEventListener('click', ()=>{quoteMode='itemized';modeItemBtn.classList.add('active');modeQuickBtn.classList.remove('active');document.getElementById('quick-section').style.display='none';document.getElementById('itemized-section').style.display=''; renderPreview();});

// Build type buttons
const typeResBtn = document.getElementById('type-res');
const typeMultiBtn = document.getElementById('type-multi');
let buildType = 'res';
typeResBtn.addEventListener('click', ()=>{buildType='res';typeResBtn.classList.add('active');typeMultiBtn.classList.remove('active')});
typeMultiBtn.addEventListener('click', ()=>{buildType='multi';typeMultiBtn.classList.add('active');typeResBtn.classList.remove('active')});
// ensure preview updates when build type changes
typeResBtn.addEventListener('click', ()=>{ renderPreview(); });
typeMultiBtn.addEventListener('click', ()=>{ renderPreview(); });

function updateBacker(){
  const pricePerBoard = Number(backerSelect.value || 0);
  const pricePerSF = pricePerBoard / 32;
  const eps = HYDRO_ITEMS.find(i=>i.key==='eps');
  if (eps) eps.mat_psf = pricePerSF;
  RATES.new.mat_psf = HYDRO_ITEMS.reduce((s,it)=>s+(it.mat_psf||0),0);
  RATES.new.lab_psf = HYDRO_ITEMS.reduce((s,it)=>s+(it.lab_psf||0),0);
  RATES.new.inst_psf = RATES.new.mat_psf + RATES.new.lab_psf;
}
backerSelect.addEventListener('change', updateBacker);
updateBacker();

function computeTotals(){
  let sf = Math.max(0, Number(sfEl.value || 0));
  let carry = Math.max(0, Number(carryEl.value || 0));
  const carryPct = buildType === 'res' ? 0.18 : 0.15;
  let tradMat = 0, tradLab = 0;
  if (quoteMode === 'quick'){
    tradMat = Math.max(0, Number(tradMatEl.value || 0));
    tradLab = Math.max(0, Number(tradLabEl.value || 0));
  } else {
    const items = [
      { matId:'mat-wrb', labId:'lab-wrb' },
      { matId:'mat-eps', labId:'lab-eps' },
      { matId:'mat-wire', labId:'lab-wire' },
      { matId:'mat-fasteners', labId:'lab-fasteners' },
      { matId:'mat-trim', labId:'lab-trim' },
      { matId:'mat-base', labId:'lab-base' },
      { matId:'mat-finish', labId:'lab-finish' },
      { matId:null, labId:'lab-prep' },
      { matId:null, labId:'lab-mobil' },
      { matId:null, labId:'lab-cleanup' }
    ];
    tradMat = items.reduce((s,it)=>{ if (!it.matId) return s; const el=document.getElementById(it.matId); let v=el?Number(el.value||0):0; return s + (isNaN(v)||v<0?0:v)},0);
    tradLab = items.reduce((s,it)=>{ if (!it.labId) return s; const el=document.getElementById(it.labId); let v=el?Number(el.value||0):0; return s + (isNaN(v)||v<0?0:v)},0);
  }
  const oldMatTot = tradMat * sf; const oldLabTot = tradLab * sf; const oldBase = (tradMat + tradLab) * sf; const oldTot = oldBase + carry;
  const newMatTot = RATES.new.mat_psf * sf; const newLabTot = RATES.new.lab_psf * sf; const newBase = RATES.new.inst_psf * sf; const carryDiscounted = carry * (1 - (buildType === 'res' ? 0.18 : 0.15)); const newTot = newBase + carryDiscounted;
  const delta = Math.max(0, oldTot - newTot); const pct = oldTot>0?((oldTot-newTot)/oldTot)*100:0;
  return { sf, carry, tradMat, tradLab, oldMatTot, oldLabTot, oldBase, oldTot, newMatTot, newLabTot, newBase, carryDiscounted, newTot, delta, pct };
}

function renderPreview(){
  const t = computeTotals();
  document.getElementById('old-mat').textContent = fmtUSD(t.oldMatTot);
  document.getElementById('old-lab').textContent = fmtUSD(t.oldLabTot);
  document.getElementById('new-mat').textContent = fmtUSD(t.newMatTot);
  document.getElementById('new-lab').textContent = fmtUSD(t.newLabTot);
  document.getElementById('carry-sav').textContent = `${fmtUSD(t.carryDiscounted)} (discounted ${(buildType==='res'?18:15)}%)`;
  document.getElementById('new-total').textContent = fmtUSD(t.newTot);
  document.getElementById('new-psf').textContent = `${fmtUSD(t.newTot/(t.sf>0?t.sf:1))}/SF`;
  document.getElementById('delta').textContent = fmtUSD(t.delta);
  document.getElementById('delta-psf').textContent = `${fmtUSD(t.delta/(t.sf>0?t.sf:1))}/SF`;
  // also update extra summary fields
  updateSummaryExtras();
}
 
 // update additional preview fields (old total, pct, old-psf)
 function updateSummaryExtras(){
   const t = computeTotals();
   const oldPerSF = t.sf > 0 ? (t.oldTot / t.sf) : 0;
   const newPerSF = t.sf > 0 ? (t.newTot / t.sf) : 0;
   document.getElementById('old-total').textContent = fmtUSD(t.oldTot);
   document.getElementById('old-psf').textContent = `${fmtUSD(oldPerSF)}/SF`;
   document.getElementById('old-psf').setAttribute('title', 'Traditional cost per SF');
   document.getElementById('pct').textContent = `${t.pct.toFixed(1)}% savings`;
 }

// Wire inputs for live preview
Array.from(document.querySelectorAll('input, select')).forEach(el=>el.addEventListener('input', ()=>{ updateBacker(); renderPreview(); }));

// Reset
document.getElementById('reset').addEventListener('click', ()=>{ document.querySelectorAll('input').forEach(i=>i.value=''); document.getElementById('sf').value=0; document.getElementById('carry-cost').value=0; renderPreview(); });

// wire right-side PDF button
const createPdfRightBtn = document.getElementById('create-pdf-right');
if (createPdfRightBtn) {
  createPdfRightBtn.addEventListener('click', ()=>{ if (createPdfBtn) createPdfBtn.click(); });
}

// (compact one-page option removed)

// Build printable HTML (mirrors XLSX content)
function buildPrintableHtml(){
  const t = computeTotals();
  // ensure eps label reflects thickness
  const eps = HYDRO_ITEMS.find(i=>i.key==='eps');
  if (eps){ const label = backerSelect.options[backerSelect.selectedIndex].text; eps.name = `Backer CI (${label})`; }

  const userItems = [
    { name: 'WRB', matId: 'mat-wrb', labId: 'lab-wrb' },
    { name: 'EPS Foam', matId: 'mat-eps', labId: 'lab-eps' },
    { name: 'Metal Wire', matId: 'mat-wire', labId: 'lab-wire' },
    { name: 'Fasteners', matId: 'mat-fasteners', labId: 'lab-fasteners' },
    { name: 'Metal Trim', matId: 'mat-trim', labId: 'lab-trim' },
    { name: 'Base Coat', matId: 'mat-base', labId: 'lab-base' },
    { name: 'Finish Coat', matId: 'mat-finish', labId: 'lab-finish' },
    { name: 'Bldg Prep', matId: null, labId: 'lab-prep' },
    { name: 'Mobilization', matId: null, labId: 'lab-mobil' },
    { name: 'Cleanup', matId: null, labId: 'lab-cleanup' }
  ];

  const now = new Date();
  const dateStr = now.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  const quoteNum = 'QB-' + now.getFullYear() + String(now.getMonth()+1).padStart(2,'0') + String(now.getDate()).padStart(2,'0');

  let html = '';
  html += `<style>
    html,body{margin:0;padding:0}
    .pdf-wrapper{padding:12px;font-family:Arial,Helvetica,sans-serif;color:#0f172a}
    .pdf-header{display:flex;justify-content:space-between;align-items:center}
    .brand{color:#509E2E;font-weight:800;font-size:20px}
    .muted{color:#64748b}
    .pdf-two-col{display:flex;gap:18px}
    .pdf-col{flex:1;min-width:0}
    h3{margin:6px 0}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:6px;border:1px solid #eaeef0;font-size:11pt}
    th{background:#f8fafc;text-align:left}
    .right{text-align:right}
    .badge{display:inline-block;background:#dcfce7;color:#065f46;border:1px solid #bbf7d0;padding:4px 8px;border-radius:999px;font-weight:700}
    .new-price{color:#509E2E;font-weight:800;font-size:22px}
  </style>`;

  html += '<div class="pdf-wrapper">';
  html += `<div class="pdf-header"><div><div class="brand">HydroBlok</div><div class="muted">Quote</div></div><div style="text-align:right"><div>${dateStr}</div><div>${quoteNum}</div></div></div>`;
  html += `<p class="muted" style="margin-top:6px">Quote susceptible to change based on individual project requirements</p>`;

  let left = '';
  left += '<h3>Job Details</h3>';
  left += '<table><tbody>';
  left += `<tr><td>Total Wall Area (SF)</td><td class="right">${t.sf}</td></tr>`;
  left += `<tr><td>Projected Carry Costs</td><td class="right">${fmtUSD(t.carry)}</td></tr>`;
  left += `<tr><td>Carry Cost Discount Rate</td><td class="right">${buildType==='res'? '18%':'15%'}</td></tr>`;
  left += `<tr><td>Build Type</td><td class="right">${buildType==='res'?'Residential':'Multi-family'}</td></tr>`;
  left += `<tr><td>Quote Mode</td><td class="right">${quoteMode==='quick'?'Quick Quote':'Itemized Quote'}</td></tr>`;
  left += '</tbody></table>';

  left += '<h3>Traditional Method Pricing</h3>';
  left += '<table><thead><tr><th>Item</th><th class="right">Value</th></tr></thead><tbody>';
  left += `<tr><td>Materials per SF</td><td class="right">${fmtUSD(t.tradMat)}</td></tr>`;
  left += `<tr><td>Labor per SF</td><td class="right">${fmtUSD(t.tradLab)}</td></tr>`;
  left += `<tr><td>Total Cost per SF</td><td class="right">${fmtUSD(t.tradMat + t.tradLab)}</td></tr>`;
  left += `<tr><td>Materials Total (${t.sf} SF)</td><td class="right">${fmtUSD(t.oldMatTot)}</td></tr>`;
  left += `<tr><td>Labor Total (${t.sf} SF)</td><td class="right">${fmtUSD(t.oldLabTot)}</td></tr>`;
  left += `<tr><td>Installation Base Cost</td><td class="right">${fmtUSD(t.oldBase)}</td></tr>`;
  left += `<tr><td>Carry Costs</td><td class="right">${fmtUSD(t.carry)}</td></tr>`;
  left += `<tr><th>TRADITIONAL TOTAL</th><th class="right">${fmtUSD(t.oldTot)}</th></tr>`;
  left += `<tr><td>Traditional Cost per SF</td><td class="right">${fmtUSD(t.oldTot/(t.sf>0?t.sf:1))}</td></tr>`;
  left += '</tbody></table>';

  left += '<h3>HydroBlok Pricing</h3>';
  left += '<table><thead><tr><th>Item</th><th class="right">Value</th></tr></thead><tbody>';
  left += `<tr><td>Materials per SF</td><td class="right">${fmtUSD(RATES.new.mat_psf)}</td></tr>`;
  left += `<tr><td>Labor per SF</td><td class="right">${fmtUSD(RATES.new.lab_psf)}</td></tr>`;
  left += `<tr><td>Total Cost per SF</td><td class="right">${fmtUSD(RATES.new.inst_psf)}</td></tr>`;
  left += `<tr><td>Materials Total (${t.sf} SF)</td><td class="right">${fmtUSD(t.newMatTot)}</td></tr>`;
  left += `<tr><td>Labor Total (${t.sf} SF)</td><td class="right">${fmtUSD(t.newLabTot)}</td></tr>`;
  left += `<tr><td>Installation Base Cost</td><td class="right">${fmtUSD(t.newBase)}</td></tr>`;
  left += `<tr><td>Carry Costs (Discounted)</td><td class="right">${fmtUSD(t.carryDiscounted)}</td></tr>`;
  left += `<tr><th>HYDROBLOK TOTAL</th><th class="right">${fmtUSD(t.newTot)}</th></tr>`;
  left += `<tr><td>HydroBlok Cost per SF</td><td class="right">${fmtUSD(t.newTot/(t.sf>0?t.sf:1))}</td></tr>`;
  left += '</tbody></table>';

  left += '<h3>Cost Comparison</h3>';
  left += '<table><tbody>';
  left += `<tr><td>Traditional Total Cost</td><td class="right">${fmtUSD(t.oldTot)}</td></tr>`;
  left += `<tr><td>HydroBlok Total Cost</td><td class="right">${fmtUSD(t.newTot)}</td></tr>`;
  left += `<tr><th>TOTAL SAVINGS</th><th class="right">${fmtUSD(t.delta)}</th></tr>`;
  left += `<tr><td>Savings Percentage</td><td class="right">${t.pct.toFixed(1)}%</td></tr>`;
  left += '</tbody></table>';

  let right = '';
  if (quoteMode === 'itemized'){
    right += '<h3>Itemized: Provided by User</h3>';
    right += '<table><thead><tr><th>Line Item</th><th class="right">Mat $/SF</th><th class="right">Lab $/SF</th></tr></thead><tbody>';
    userItems.forEach(it=>{
      const mat = it.matId?document.getElementById(it.matId).value:'';
      const lab = it.labId?document.getElementById(it.labId).value:'';
      right += `<tr><td>${it.name}</td><td class="right">${mat!==''?fmtUSD(Number(mat)):''}</td><td class="right">${lab!==''?fmtUSD(Number(lab)):''}</td></tr>`;
    });
    right += '</tbody></table>';
  }

  right += '<h3>HydroBlok Itemized</h3>';
  right += '<table><thead><tr><th>Line Item</th><th class="right">Mat $/SF</th><th class="right">Lab $/SF</th></tr></thead><tbody>';
  HYDRO_ITEMS.forEach(it=>{
    right += `<tr><td>${it.name}</td><td class="right">${typeof it.mat_psf==='number'?fmtUSD(it.mat_psf):''}</td><td class="right">${typeof it.lab_psf==='number'?fmtUSD(it.lab_psf):''}</td></tr>`;
  });
  right += '</tbody></table>';

  right += '<h3>Advantages</h3>';
  right += '<ul>';
  right += '<li>Better resale value over time</li>';
  right += '<li>Builders insurance savings</li>';
  right += '<li>No lath inspections required</li>';
  right += '<li>De-risk labor inflation costs</li>';
  right += '<li>Shorter curing times between coats</li>';
  right += '<li>Reduced trash haul away and project costs</li>';
  right += '<li>Improved durability and weather resistance</li>';
  right += '</ul>';

  html += '<div class="pdf-two-col">';
  html += `<div class="pdf-col">${left}</div>`;
  html += `<div class="pdf-col">${right}</div>`;
  html += '</div>';

  html += '<p style="margin-top:12px;color:#64748b">Generated by Instant Quote Calculator</p>';
  html += '</div>';
  return html;
}

// PDF export handler
createPdfBtn.addEventListener('click', async ()=>{
  try {
    const t = computeTotals();
    if (t.oldTot === 0 && t.newTot === 0){ alert('Cannot export: quote totals are zero. Enter inputs and calculate before exporting.'); return; }
    const html = buildPrintableHtml();
    const container = document.getElementById('pdf-content');
    container.innerHTML = html;
    // Make sure container is visible and has a printable width so html2pdf can capture it
    container.style.display = 'block';
    container.style.maxWidth = '760px';
    container.style.margin = '0 auto';
    container.style.background = '#ffffff';
    container.style.padding = '18px';
    container.style.boxSizing = 'border-box';
    // scroll into view to ensure rendering in some browsers
    try { container.scrollIntoView(); } catch(e){}
    // tiny delay to allow browser to layout injected HTML
    await new Promise(res => setTimeout(res, 200));
    console.log('PDF container HTML length:', container.innerHTML.length);
    if (!container.innerHTML || container.innerHTML.trim().length === 0) { alert('PDF content empty — aborting export.'); container.style.display='none'; return; }

    const now = new Date();
    const quoteNum = 'QB-' + now.getFullYear() + String(now.getMonth()+1).padStart(2,'0') + String(now.getDate()).padStart(2,'0');
    const sf = Math.max(0, Number(sfEl.value || 0));
    const sfStr = Number.isInteger(sf) ? String(sf) : String(sf).replace('.', '_');
    const filename = 'HydroBlok-Quote-' + sfStr + 'SF-' + quoteNum + '.pdf';

    // Render container to canvas and scale to a single PDF page (two-column printable layout)
    try {
      const canvas = await html2canvas(container, { scale: 2, useCORS: true });
      const imgData = canvas.toDataURL('image/jpeg', 0.92);
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ unit: 'pt', format: 'letter', orientation: 'portrait' });
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();
      const margin = 12;
      const availW = pageWidth - margin * 2;
      const availH = pageHeight - margin * 2;
      const pxPerPt = canvas.width / availW;
      const imgHeightPt = canvas.height / pxPerPt;
      let drawW = availW;
      let drawH = imgHeightPt;
      // scale down if needed to fit a single page
      if (imgHeightPt > availH) {
        const scale = availH / imgHeightPt;
        drawW = availW * scale;
        drawH = availH;
      }
      const x = margin + ((availW - drawW) / 2);
      const y = margin + ((availH - drawH) / 2);
      pdf.addImage(imgData, 'JPEG', x, y, drawW, drawH);
      pdf.save(filename);
    } catch(errCanvas){
      console.error('canvas->PDF error', errCanvas);
      // fallback to html2pdf if canvas approach fails
      const opt = {
        margin: 12,
        filename: filename,
        image: { type: 'jpeg', quality: 0.92 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'pt', format: 'letter', orientation: 'portrait' },
        pagebreak: { mode: ['css', 'legacy'] }
      };
      await html2pdf().set(opt).from(container).save();
    }
    // cleanup
    container.style.display = 'none';
    container.innerHTML = '';

    // cleanup (for success path above canvas->PDF already saved)
    container.style.display = 'none';
    container.innerHTML = '';
  } catch(e){ console.error('PDF export error', e); alert('Error generating PDF: '+ (e && e.message ? e.message : e)); }
});

// initial render
renderPreview();
</script>
</body>
</html>

